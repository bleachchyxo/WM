#!/bin/sh

# Source profile if it exists
[ -f ~/.xprofile ] && . ~/.xprofile

# Start xcompmgr for compositing effects
xcompmgr -cC -t.25 -r2.2 -o.25 &

# Auto-detect interfaces
wifi_path=$(ls /sys/class/net | awk '/wlp|wlan/ {print $1; exit}')
eth_path=$(ls /sys/class/net | awk '/enp|eth/ {print $1; exit}')

# Function to get network status
get_network_status() {
    [ -e "/sys/class/net/$wifi_path/operstate" ] && wifi_state=$(<"/sys/class/net/$wifi_path/operstate")
    [ -e "/sys/class/net/$eth_path/operstate" ] && ethernet_state=$(<"/sys/class/net/$eth_path/operstate")
    [ "$wifi_state" = "up" ] || [ "$ethernet_state" = "up" ] && echo "Up" || echo "Down"
}

# Function to get volume status
get_volume_status() {
    amixer get Master | awk -F'[][]' 'END{ print $2 }'
}

# Function to get battery status (optional)
get_battery_status() {
    [ -e "$bat_path/capacity" ] && {
        bstat=$(<"$bat_path/capacity")
        bat_status=$(<"$bat_path/status")
        echo "| BAT: $bstat% $( [ "$bat_status" = "Charging" ] && echo "âš¡" )"
    } || echo ""
}

# Main loop
while true; do
    vol_stat=$(get_volume_status)
    net_stat=$(get_network_status)
    bat_stat=$(get_battery_status)

    # Set the status bar
    xsetroot -name "WEB: $net_stat $bat_stat VOL: $vol_stat | $(date '+%d/%m/%Y %H:%M')"

    # Update every second
    sleep 1
done &

# Start window manager
exec dwm

